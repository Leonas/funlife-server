<!DOCTYPE html>
<html>
    <head>
        <title>FunLife</title>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <META CONTENT="no-cache">
        <!--removed script because it breaks jqmobi-->
        <script src="https://trigger.io/catalyst/target/target-script-min.js#165B5ECF-E15E-4F3F-BA08-6D20334B185E"></script>
        <script>

                if( typeof forge === 'undefined' && typeof device === 'undefined'){
                    //if not running on a mobile device
                    var server = 'http://'+document.location.host;
                } else {
                    var server = 'http://vast-crag-6780.herokuapp.com';
                    //use the remote server for all connections

                    //forge.enableDebug();               //broken -> the catalyst script file breaks everything


                    //Tried to use catalyst: https://trigger.io/catalyst/ but it breaks jqmobi
                }
        </script>

        <script src="core/jq.mobi.js"></script>
        <script src="core/jq.ui.js"></script>

        <script src="core/addons.js"></script>

        <!--For more jqUI info: https://github.com/html5mgithub/jQ.Mobi/tree/master/ui-->
        <script src="core/jq.mvc.js"></script>
        <script src="core/doT.js"></script>
        <script src="core/models.js"></script>
        <script src="core/controllers.js"></script>

        <link rel="stylesheet" type="text/css" href="layout/css/jq.ui.css" />
        <link rel="stylesheet" type="text/css" href="layout/css/jquerymobile_theme.css" />
        <link rel="stylesheet" type="text/css" href="layout/css/bottom_nav.css" />
        <link rel="stylesheet" type="text/css" href="layout/css/icons.css" />
        <link rel="stylesheet" type="text/css" href="layout/css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="layout/css/custom.css" />

        <script>
            var debug;        //for testing stuff
            var current_user;

            var app = new $.mvc.app();
            app.loadModels(["user", "chat"]);
            app.loadControllers(["users_controller", "chats_controller"]);
            app.listenHashChange();
            app.useHTML5History(true);
            app.ready(function () {
//                $.mvc.route("/users_controller");
                current_user.get_from_local();                           //Load current user to memory from localstorage


                if (current_user.token.length > 5) {                       //if the current user's token exists, try to auth
                    $.mvc.route("/users_controller/users_list");
                } else {
                    console.log("token not found on localstorage. displaying login");
                    //$.mvc.route("/users_controller/user_login");
                    $.ui.addContentDiv("user_login_view", $.template('views/users/user_login_view.js'), "Login or Register");
                    $.ui.loadContent("user_login_view", false, false, "fade"); //Show the user_login_view
                }
            });
        </script>
    </head>

	<body>
		<div id="jqUI">
            <div id="header"></div>

            <div id="content">
                <!--<div id="mainPanel" title="Welcome" class="panel" data-footer="navbarXX"></div>-->
            </div>

            <div id="footer" class="nav-glyphish-example ui-footer ui-bar-a ui-footer ui-bar-a ui-panel-content-fixed-toolbar ui-panel-content-fixed-toolbar-closed ui-footer-fixed">
                <div class="nav-glyphish-example ui-navbar ui-mini">
                    <ul class="ui-grid-d">
                        <li class="ui-block-a">
                            <a href="#" id="chat" class="ui-btn ui-btn-inline ui-btn-icon-top ui-btn-up-a ui-btn-active">
                        <span class="ui-btn-inner">
                          <span class="ui-icon ui-icon-custom ui-icon-shadow ui-icon-home">&nbsp;</span>
                        </span></a>
                        </li>
                        <li class="ui-block-b"><a href="#" id="email" class="ui-btn ui-btn-inline ui-btn-icon-top ui-btn-up-a">
                        <span class="ui-btn-inner">
                        <span class="ui-icon ui-icon-custom ui-icon-shadow ui-icon-photos">&nbsp;</span></span></a>
                        </li>
                        <li class="ui-block-c"><a href="#" id="skull" class="ui-btn ui-btn-inline ui-btn-icon-top ui-btn-up-a">
                        <span class="ui-btn-inner">
                        <span class="ui-icon ui-icon-custom ui-icon-shadow ui-icon-camera">&nbsp;</span>
                      </span>
                        </a>
                        </li>
                        <li class="ui-block-d">
                            <a href="#" id="beer" class="ui-btn ui-btn-inline ui-btn-icon-top ui-btn-up-a">
                        <span class="ui-btn-inner">
                          <span class="ui-icon ui-icon-custom ui-icon-shadow ui-icon-locations">&nbsp;</span>
                        </span>
                            </a>
                        </li>
                        <li class="ui-block-e">
                            <a href="#" id="coffee" class="ui-btn ui-btn-up-a ui-btn-inline ui-btn-icon-top">
                        <span class="ui-btn-inner">
                          <span class="ui-icon ui-icon-custom ui-icon-shadow ui-icon-people">&nbsp;</span>
                        </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <nav id="main_nav">
                <div class='title'>Home</div>
                <ul>
                    <li class="icon home mini"><a href="#main">#maindiv</a></li>
                </ul>
            </nav>
        </div>
    </body>
</html>
